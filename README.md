# Рогатнев Дмитрий Александрович БПИ 229

## Вариант 23

Задача о болтунах. N болтунов имеют телефоны. Они либо некоторое (случайное) время ждут звонков, либо звонят друг другу, чтобы побеседовать. Если телефон случайного абонента занят, болтун будет звонить другому случайному абоненту, пока ему кто-нибудь не ответит. Побеседовав некоторое время, болтун или ждет звонка, или звонит на другой случайный номер.
**Создать многопроцессное приложение, моделирующее поведение болтунов.**
*Каждый болтун моделируется отдельным процессом.*

## 4-5

### Запуск

Для запуска программы компилируем её:

```shell
gcc -o main main.c
```

И далее запускаем:

```shell
./main
```

### Описание программы

Выбран следующий вариант работы семафоров:

* Множество процессов взаимодействуют с использованием неименованных POSIX семафоров расположенных в разделяемой памяти. Обмен данными также ведется через разделяемую память в стандарте POSIX.

Программа написана на языке C и моделирует работу "болтунов" - процессов, которые могут звонить друг другу.

1. Программа начинается с определения структуры `shared_data`, которая содержит два массива семафоров (`semaphores` и `call_semaphores`) и массив `busy` для отслеживания состояния каждого болтуна (занят он или нет).

2. Функция `chatterbox` моделирует поведение каждого болтуна. Болтун может либо звонить другому болтуну, либо ждать звонка. Если болтун решает сделать звонок, он выбирает случайного болтуна, который в данный момент не занят, и звонит ему. Во время звонка оба болтуна считаются занятыми.

3. В функции `main` создается общая область памяти для структуры `shared_data` и инициализируются семафоры для каждого болтуна. Затем для каждого болтуна создается дочерний процесс, в котором вызывается функция `chatterbox`.

4. Функция cleanup вызывается при получении сигнала SIGINT (который посылается при нажатии Ctrl+C). Эта функция завершает все дочерние процессы и уничтожает все семафоры, освобождая таким образом все выделенные ресурсы.

В целом, программа демонстрирует использование семафоров для синхронизации процессов и общей памяти для обмена данными между процессами. Подробнее о работе программы написано в комментариях к коду.

### Пример работы программы

``` txt
Количество болтунов: 5
Болтун 0 звонит болтуну 3
Болтун 1 звонит болтуну 2
Болтун 1 закончил звонить болтуну 2
Болтун 4 звонит болтуну 2
Болтун 1 ждет звонка...
Болтун 0 закончил звонить болтуну 3
Болтун 4 закончил звонить болтуну 2
Болтун 4 ждет звонка...
Болтун 2 звонит болтуну 3
Болтун 1 ждет звонка...
Болтун 0 звонит болтуну 1
Болтун 0 закончил звонить болтуну 1
Болтун 4 ждет звонка...
Болтун 2 закончил звонить болтуну 3
Болтун 0 звонит болтуну 3
Болтун 0 закончил звонить болтуну 3
Болтун 0 ждет звонка...
Болтун 2 звонит болтуну 0
Болтун 1 ждет звонка...
```

## 6-7

### Запуск

Для запуска программы компилируем её:

```shell
gcc -o main main.c
```

И далее запускаем:

```shell
./main
```

### Описание программы

Выбран следующий вариант работы семафоров:

* Множество процессов взаимодействуют с использованием именованных POSIX семафоров. Обмен данными ведется через разделяемую память в стандарте POSIX.

### Использование именованных семафоров

В программе используются два массива именованных семафоров: `semaphores` и `call_semaphores`. Первый массив используется для синхронизации действий болтунов, а второй - для сигнализации о входящих звонках.

Именованные семафоры создаются с помощью функции sem_open, которой передается имя семафора и начальное значение. Имена семафоров формируются с помощью функции `sprintf`, которая записывает в строку `sem_name` имя семафора в формате "/sem_%d" или "/call_sem_%d", где %d заменяется на номер болтуна.

После использования семафоры закрываются с помощью функции `sem_close` и удаляются с помощью функции `sem_unlink`.

### Пример работы программы

``` txt
Количество болтунов: 5
Болтун 0 звонит болтуну 2
Болтун 1 звонит болтуну 3
Болтун 1 закончил звонить болтуну 3
Болтун 4 звонит болтуну 1
Болтун 0 закончил звонить болтуну 2
Болтун 4 закончил звонить болтуну 1
Болтун 2 звонит болтуну 3
Болтун 4 звонит болтуну 0
Болтун 1 ждет звонка...
Болтун 2 закончил звонить болтуну 3
Болтун 4 закончил звонить болтуну 0
Болтун 0 ждет звонка...
Болтун 3 ждет звонка...
Болтун 2 ждет звонка...
Болтун 4 ждет звонка...
Болтун 3 звонит болтуну 4
Болтун 1 звонит болтуну 0
Болтун 3 закончил звонить болтуну 4
Болтун 3 звонит болтуну 4
Болтун 3 закончил звонить болтуну 4
Болтун 4 ждет звонка...
```